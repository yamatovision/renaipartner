# オンボーディング簡素化提案

## 現在の問題点

### 1. API設計が複雑
- `POST /api/onboarding/start` - 開始
- `GET /api/onboarding/:userId/progress` - 進捗取得
- `PUT /api/onboarding/:userId/progress` - 進捗更新（毎ステップ）
- `POST /api/onboarding/:userId/complete` - 完了

### 2. 毎ステップでの保存による問題
- ネットワークエラーのリスク増大
- データベース負荷
- 複雑なエラーハンドリング
- 状態の不整合

## 提案：シンプルな実装

### 新しいAPI構成
```
POST /api/partners/create-with-onboarding
```

1つのエンドポイントで全て処理：
- ユーザー情報の更新
- パートナーの作成
- 初期メッセージの生成

### フロントエンドの変更
```typescript
// 現在：各ステップで保存
const nextStep = async () => {
  await onboardingService.updateProgress(userId, data) // 削除
  setCurrentStep(currentStep + 1)
}

// 新実装：ローカルで管理
const nextStep = () => {
  setCurrentStep(currentStep + 1)
  // API呼び出しなし
}

// 最後に一括保存
const completeOnboarding = async () => {
  const response = await partnersService.createWithOnboarding({
    userData: {
      firstName: formData.firstName,
      lastName: formData.lastName,
      birthday: formData.birthday
    },
    partnerData: {
      name: formData.partnerName,
      gender: formData.gender,
      personality: formData.personality,
      // ... その他のデータ
    }
  })
  
  if (response.success) {
    router.push('/home')
  }
}
```

### メリット
1. **シンプル** - API呼び出しが1回のみ
2. **高速** - ネットワーク待機時間の削減
3. **安定** - エラーハンドリングが簡単
4. **保守性** - コードが理解しやすい

### デメリット
1. 途中離脱時にデータが失われる
   → 解決策：LocalStorageに一時保存

### 実装手順
1. フロントエンドで全ステップをローカル管理に変更
2. バックエンドに新しいエンドポイントを追加
3. 既存のオンボーディングテーブルは削除（不要）