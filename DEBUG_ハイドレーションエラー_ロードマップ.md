# ハイドレーションエラー デバッグロードマップ

## エラー概要
- **エラー種別**: Next.js Hydration Error
- **発生箇所**: app/login/page.tsx (93行目)
- **影響範囲**: ログインページのMUI Boxコンポーネント

## 根本原因の分析

### 1. React 19とMUI 6の互換性問題 ⚠️ 最重要
- React 19.1.0（実験的バージョン）とMUI 6.4.12の組み合わせ
- React 19はまだ安定版ではなく、MUIとの完全な互換性が保証されていない

### 2. サーバー/クライアント状態の不一致
- AuthContextでの`window`オブジェクト参照
- `Date.now()`による動的な値の生成
- 初期loading状態の不整合

### 3. MUIコンポーネントのSSR問題
- emotion/styledによるCSS生成の不一致
- 動的なスタイリングによる問題

## 修正アプローチ（優先順位順）

### ステップ1: React 18へのダウングレード 🔥
**理由**: React 19は実験的であり、プロダクション環境では推奨されない
```bash
npm install react@18.3.1 react-dom@18.3.1 --save-exact
```

### ステップ2: AuthContextの修正
1. SSR時の初期状態を明確に定義
2. useEffectでのみクライアントサイドのロジックを実行
3. loading状態の初期値を調整

### ステップ3: ログインページの修正
1. MUIコンポーネントの動的インポート検討
2. 絵文字アイコンの使用方法見直し
3. suppressHydrationWarningの追加（一時対策）

### ステップ4: デバッグログの設置
1. SSR/CSRの状態差分を記録
2. MUIテーマの適用状況を確認
3. エラー発生箇所の特定

## デバッグ用ログポイント

1. **AuthContext**
   - 初期化時の状態
   - トークン検証結果
   - loading状態の変化

2. **LoginPage**
   - レンダリング開始時
   - MUIコンポーネントのプロップス
   - フォーム状態

3. **ルートレイアウト**
   - テーマプロバイダーの初期化
   - クライアントサイドのマウント状態

## 検証手順

1. 開発環境でのエラー再現
2. React DevToolsでの状態確認
3. ネットワークタブでのSSR HTMLとCSR HTMLの比較
4. 各修正後の動作確認

## 成功基準

- ハイドレーションエラーが解消される
- ページの初期表示が正常
- ログイン機能が正常に動作
- パフォーマンスの劣化がない