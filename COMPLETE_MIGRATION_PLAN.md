# ãƒ¢ãƒƒã‚¯ã‹ã‚‰å®ŸAPIã¸ã®å®Œå…¨ç§»è¡Œè¨ˆç”»æ›¸

## ç¾çŠ¶åˆ†æã‚µãƒãƒªãƒ¼

### âœ… å®Œäº†æ¸ˆã¿é …ç›®
1. **APIã‚µãƒ¼ãƒ“ã‚¹å±¤**: ã™ã¹ã¦å®ŸAPIä½¿ç”¨ã«ç§»è¡Œæ¸ˆã¿
2. **ãƒ¢ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«**: å‰Šé™¤æ¸ˆã¿ï¼ˆservices/mock/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
3. **ç’°å¢ƒè¨­å®š**: APIæ¥ç¶šè¨­å®šå®Œäº†ï¼ˆlocalhost:8080ï¼‰
4. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…**: å…¨50ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆæ¸ˆã¿

### âŒ æœªå®Œäº†é …ç›®
1. **APIå®šç¾©ã®ä¸ä¸€è‡´**: å‹å®šç¾©ã¨å®Ÿè£…ã®ãƒ‘ã‚¹ãŒç•°ãªã‚‹
2. **ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿**: è¨­å®šãƒšãƒ¼ã‚¸ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æ®‹å­˜
3. **JWTæ¤œè¨¼**: ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§æœªå®Ÿè£…
4. **ä¸€éƒ¨ã®APIçµ±åˆ**: è¨­å®šãƒšãƒ¼ã‚¸ã®èƒŒæ™¯ç”»åƒãªã©

## Phase 1: APIå®šç¾©ã®ä¿®æ­£ï¼ˆæ¨å®šæ™‚é–“: 1-2æ™‚é–“ï¼‰

### 1.1 ç®¡ç†è€…APIãƒ‘ã‚¹ã®ä¿®æ­£
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/types/index.ts`, `backend/src/types/index.ts`

```typescript
// ä¿®æ­£å‰
ADMIN: {
  BASE: '/api/admin',
  USERS: {
    BASE: '/api/admin/users',
    CREATE: '/api/admin/users/create',  // å‰Šé™¤
    LIST: '/api/admin/users/list',      // å‰Šé™¤
    DEACTIVATE: (id: string) => `/api/admin/users/${id}/deactivate`,
    ACTIVATE: (id: string) => `/api/admin/users/${id}/activate`,
  },
  STATS: '/api/admin/stats',  // å‰Šé™¤ã¾ãŸã¯ä¿®æ­£
}

// ä¿®æ­£å¾Œ
ADMIN: {
  BASE: '/api/admin',
  USERS: {
    BASE: '/api/admin/users',
    DEACTIVATE: (id: string) => `/api/users/${id}/deactivate`,  // ä¿®æ­£
    ACTIVATE: (id: string) => `/api/users/${id}/activate`,      // ä¿®æ­£
  },
}
```

### 1.2 çµ±è¨ˆAPIãƒ‘ã‚¹ã®ä¿®æ­£
```typescript
// å®Ÿéš›ã®ãƒ‘ã‚¹ã«åˆã‚ã›ã¦ä¿®æ­£
USERS: {
  // ...
  STATS: '/api/users/stats',  // è¿½åŠ 
}
```

### 1.3 ä¸è¦ãªAPIå®šç¾©ã®å‰Šé™¤
- `/api/auth/register` - å®Ÿè£…ãªã—ã€å‰Šé™¤
- `/api/data/*` - å®Ÿè£…ãªã—ã€å‰Šé™¤

### 1.4 APIã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°
**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `frontend/src/services/api/admin.api.ts`
- `frontend/src/services/api/auth.api.ts`

## Phase 2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã®é™¤å»ï¼ˆæ¨å®šæ™‚é–“: 1æ™‚é–“ï¼‰

### 2.1 ãƒ†ã‚¹ãƒˆèªè¨¼æƒ…å ±ã®å‰Šé™¤
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/app/login/page.tsx`

```typescript
// å‰Šé™¤å¯¾è±¡ï¼šè¡Œ146-185, 279-287
// ãƒ†ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã®è¡¨ç¤ºéƒ¨åˆ†ã‚’å®Œå…¨å‰Šé™¤
```

### 2.2 ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æ”¹å–„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/app/admin/users/page.tsx`

```typescript
// è¡Œ81-83ã®ä¿®æ­£
const newUser = {
  email: '',  // ç©ºæ–‡å­—ã«å¤‰æ›´
  displayName: '',
  role: 'USER' as const,
}
```

## Phase 3: è¨­å®šãƒšãƒ¼ã‚¸ã®å®Œå…¨å®Ÿè£…ï¼ˆæ¨å®šæ™‚é–“: 2-3æ™‚é–“ï¼‰

### 3.1 èƒŒæ™¯ç”»åƒAPIã®å®Ÿè£…åˆ¤æ–­
**ã‚ªãƒ—ã‚·ãƒ§ãƒ³1**: èƒŒæ™¯ç”»åƒæ©Ÿèƒ½ã‚’å‰Šé™¤
- è¡Œ80-86ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸèƒŒæ™¯ç”»åƒãƒªã‚¹ãƒˆã‚’å‰Šé™¤
- é–¢é€£UIã‚’å‰Šé™¤

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³2**: å®ŸAPIå®Ÿè£…
- `settingsService.getBackgrounds()`ãŒæ—¢ã«å®Ÿè£…æ¸ˆã¿
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®`/api/images/backgrounds`ã‚’ä½¿ç”¨

### 3.2 é€šçŸ¥è¨­å®šã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤å‡¦ç†
```typescript
// è¡Œ64-78ã®æ”¹å–„
useEffect(() => {
  const loadSettings = async () => {
    try {
      const [userResponse, settingsResponse] = await Promise.all([
        authService.getCurrentUser(),
        settingsService.getSettings()
      ])
      
      if (settingsResponse.success && settingsResponse.data) {
        setUserSettings(settingsResponse.data.userSettings)
        setNotificationSettings(settingsResponse.data.notifications)
      }
      
      // èƒŒæ™¯ç”»åƒã¯APIã‹ã‚‰å–å¾—
      const bgResponse = await imagesService.getBackgrounds()
      if (bgResponse.success && bgResponse.data) {
        setBackgroundImages(bgResponse.data)
      }
    } catch (error) {
      console.error('è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error)
    } finally {
      setLoading(false)
    }
  }
  
  loadSettings()
}, [])
```

### 3.3 [MOCK]è¡¨ç¤ºã®å‰Šé™¤
- è¡Œ445ã®`[MOCK]`æ–‡å­—åˆ—ã‚’å‰Šé™¤

## Phase 4: JWTæ¤œè¨¼ã®å®Ÿè£…ï¼ˆæ¨å®šæ™‚é–“: 2æ™‚é–“ï¼‰

### 4.1 ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®æ›´æ–°
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/middleware.ts`

```typescript
import { jwtDecode } from 'jwt-decode'

// JWTæ¤œè¨¼ã®å®Ÿè£…
try {
  const decoded = jwtDecode<{ exp: number }>(token)
  const isExpired = decoded.exp * 1000 < Date.now()
  
  if (isExpired) {
    // ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã®å ´åˆã®å‡¦ç†
    return NextResponse.redirect(new URL('/login', request.url))
  }
} catch (error) {
  // ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã®å ´åˆ
  return NextResponse.redirect(new URL('/login', request.url))
}
```

## Phase 5: ã‚³ãƒ¼ãƒ‰ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆæ¨å®šæ™‚é–“: 1æ™‚é–“ï¼‰

### 5.1 ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®æ•´ç†
```bash
# é–‹ç™ºç”¨ãƒ­ã‚°ã®ç¢ºèª
rg "console\.(log|warn|error)" --type ts --type tsx frontend/

# æœ¬ç•ªç”¨ã«é©åˆ‡ãªãƒ­ã‚®ãƒ³ã‚°ã¸ç½®ãæ›ãˆ
```

### 5.2 æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤
- ç®¡ç†è€…ãƒšãƒ¼ã‚¸ã®ç©ºã®useEffectï¼ˆè¡Œ122-124ï¼‰
- ãã®ä»–ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰

## å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| Phase | ã‚¿ã‚¹ã‚¯ | å„ªå…ˆåº¦ | æ¨å®šæ™‚é–“ | ä¾å­˜é–¢ä¿‚ |
|-------|--------|--------|----------|----------|
| 1 | APIå®šç¾©ã®ä¿®æ­£ | ğŸ”´ é«˜ | 1-2æ™‚é–“ | ãªã— |
| 2 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã®é™¤å» | ğŸ”´ é«˜ | 1æ™‚é–“ | ãªã— |
| 3 | è¨­å®šãƒšãƒ¼ã‚¸ã®å®Œå…¨å®Ÿè£… | ğŸŸ¡ ä¸­ | 2-3æ™‚é–“ | Phase 1 |
| 4 | JWTæ¤œè¨¼ã®å®Ÿè£… | ğŸŸ¡ ä¸­ | 2æ™‚é–“ | ãªã— |
| 5 | ã‚³ãƒ¼ãƒ‰ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— | ğŸŸ¢ ä½ | 1æ™‚é–“ | Phase 1-4 |

**åˆè¨ˆæ¨å®šæ™‚é–“**: 7-9æ™‚é–“

## ãƒ†ã‚¹ãƒˆè¨ˆç”»

### Phaseå®Œäº†ã”ã¨ã®ãƒ†ã‚¹ãƒˆé …ç›®
1. **Phase 1å®Œäº†å¾Œ**
   - ç®¡ç†è€…æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
   - APIã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª

2. **Phase 2å®Œäº†å¾Œ**
   - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºç¢ºèª
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ãŒéœ²å‡ºã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª

3. **Phase 3å®Œäº†å¾Œ**
   - è¨­å®šãƒšãƒ¼ã‚¸ã®å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
   - èƒŒæ™¯ç”»åƒã®é¸æŠãƒ»ä¿å­˜

4. **Phase 4å®Œäº†å¾Œ**
   - ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œã®ãƒ†ã‚¹ãƒˆ
   - ä¸æ­£ãªãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ†ã‚¹ãƒˆ

5. **Phase 5å®Œäº†å¾Œ**
   - å…¨ä½“çš„ãªå‹•ä½œç¢ºèª
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

## ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | å¯¾ç­– |
|--------|--------|------|
| APIå®šç¾©å¤‰æ›´ã«ã‚ˆã‚‹æ—¢å­˜æ©Ÿèƒ½ã®ç ´å£Š | é«˜ | æ®µéšçš„ãªå¤‰æ›´ã¨å³åº§ã®ãƒ†ã‚¹ãƒˆ |
| JWTå®Ÿè£…ã«ã‚ˆã‚‹ãƒ­ã‚°ã‚¤ãƒ³ä¸èƒ½ | é«˜ | é–‹ç™ºç’°å¢ƒã§ã®ååˆ†ãªãƒ†ã‚¹ãƒˆ |
| èƒŒæ™¯ç”»åƒAPIå®Ÿè£…ã®å·¥æ•°è¶…é | ä¸­ | æ©Ÿèƒ½å‰Šé™¤ã®é¸æŠè‚¢ã‚’æ¤œè¨ |

## æˆåŠŸåŸºæº–
1. ã™ã¹ã¦ã®ãƒ¢ãƒƒã‚¯é–¢é€£ã‚³ãƒ¼ãƒ‰ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹
2. ã™ã¹ã¦ã®APIãŒå®Ÿãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨æ­£å¸¸ã«é€šä¿¡ã—ã¦ã„ã‚‹
3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒé™¤å»ã•ã‚Œã¦ã„ã‚‹
4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
5. æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™ãŒå®Œäº†ã—ã¦ã„ã‚‹