# 機能拡張計画: モバイルアプリリリース 2025-06-15

## 1. 拡張概要

現在のWebアプリケーション「AI彼氏女」をCapacitorを使用してiOS/Androidの両プラットフォームでネイティブアプリとしてリリースする。既存のNext.jsアプリケーションをそのまま活用し、WebViewベースでアプリ化することで短期間での開発を実現。App StoreとGoogle Playストアでの配信を目指す。将来的には生体認証などのネイティブ機能の追加を想定。

## 2. 詳細仕様

### 2.1 現状と課題

現在はNext.jsベースのWebアプリケーションとして実装されており、レスポンシブデザインによりモバイルブラウザでも利用可能。しかし、ネイティブアプリとしての配信は行われておらず、プッシュ通知やオフライン対応、アプリストアでの露出といったモバイルアプリならではの利点を活用できていない。

### 2.2 拡張内容

Capacitorを使用して既存のNext.jsアプリケーションをネイティブアプリ化する。現在のWebコードをそのまま活用できるため、UIの作り直しは不要。初期リリースでは現在のWeb機能（ユーザー認証、パートナー管理、チャット、画像生成、場所連動）をすべて含む。必要に応じてCapacitorプラグインを使用してネイティブ機能を追加。

## 3. ディレクトリ構造

```
/frontend/                           # 既存のNext.jsプロジェクト
├── capacitor.config.ts              # Capacitor設定ファイル
├── ios/                             # iOS用プロジェクト（Capacitor生成）
│   ├── App/
│   ├── Podfile
│   └── App.xcworkspace
├── android/                         # Android用プロジェクト（Capacitor生成）
│   ├── app/
│   ├── gradle/
│   └── build.gradle
├── public/
│   └── capacitor/                   # Capacitor用アセット
│       ├── app-icon/               # アプリアイコン
│       └── splash/                 # スプラッシュ画面
└── src/
    └── capacitor/                   # Capacitor関連のコード
        ├── plugins/                 # カスタムプラグイン
        └── native-bridge.ts         # ネイティブ機能のブリッジ
```

## 4. 技術的影響分析

### 4.1 影響範囲

- **フロントエンド**: 最小限の変更のみ。Capacitor統合用の設定追加
- **バックエンド**: 既存APIをそのまま使用。変更不要
- **データモデル**: 変更なし
- **その他**: アプリ用のアイコン・スプラッシュ画面の準備、アプリストア申請準備

### 4.2 変更が必要なファイル

```
- frontend/package.json: Capacitor関連パッケージの追加
- frontend/next.config.js: 静的エクスポート設定の確認
- frontend/src/services/api.ts: ベースURLの環境変数対応（必要に応じて）
- frontend/.env.example: モバイルアプリ用の環境変数追加
```

## 5. タスクリスト

```
- [ ] **T1**: Capacitor開発環境のセットアップ
- [ ] **T2**: Next.jsプロジェクトへのCapacitor統合
- [ ] **T3**: 静的ビルドの最適化とテスト
- [ ] **T4**: iOS用プロジェクトの生成と設定
- [ ] **T5**: Android用プロジェクトの生成と設定
- [ ] **T6**: アプリアイコン・スプラッシュ画面の作成と設定
- [ ] **T7**: 認証フローのモバイル対応確認（localStorage → Capacitor Storage）
- [ ] **T8**: APIエンドポイントの設定確認
- [ ] **T9**: iOS実機でのテストとデバッグ
- [ ] **T10**: Android実機でのテストとデバッグ
- [ ] **T11**: App Store Connect設定とプロビジョニング
- [ ] **T12**: Google Play Console設定
- [ ] **T13**: アプリストア申請用素材の準備（スクリーンショット、説明文）
- [ ] **T14**: App Store申請
- [ ] **T15**: Google Play申請
```

## 6. テスト計画

### 6.1 機能テスト
- ユーザー認証フロー（ログイン、登録、ログアウト）
- パートナー作成・編集・削除
- チャット送受信
- 画像生成と表示
- 場所変更機能
- WebView内でのナビゲーション

### 6.2 プラットフォーム別テスト
- iOS: iPhone各種サイズでの表示確認
- Android: 各種画面サイズ、OSバージョン確認
- タブレット対応の確認

### 6.3 パフォーマンステスト
- アプリ起動時間
- ページ読み込み速度
- API通信レスポンス
- メモリ使用量

## 7. SCOPE_PROGRESSへの統合

SCOPE_PROGRESS.mdに以下のタスクとして追加：

```markdown
- [ ] **EXT-006**: モバイルアプリリリース
  - 目標: 2025-07-15
  - 参照: [/docs/plans/planning/ext-mobile-app-release-2025-06-15.md]
  - 内容: Capacitorを使用したiOS/Android両プラットフォームでのアプリリリース
```

## 8. 備考

### 8.1 技術選定理由
- **Capacitor**: 既存のWebコードをそのまま活用でき、開発期間を大幅に短縮
- **WebViewベース**: UIの作り直しが不要で、Web版との一貫性を保持
- **プラグインエコシステム**: 必要に応じてネイティブ機能を段階的に追加可能

### 8.2 将来的な拡張
- プッシュ通知機能（Capacitor Push Notifications Plugin）
- 生体認証（Capacitor Biometric Auth Plugin）
- オフライン対応（Service Worker + Capacitor Storage）
- ディープリンク対応
- アプリ内課金機能

### 8.3 注意事項
- アプリストア審査基準への準拠（特にAI生成コンテンツに関するガイドライン）
- プライバシーポリシー、利用規約の準備
- WebViewアプリとしての制限事項の理解
- Next.jsの静的エクスポート設定の最適化

### 8.4 工数見積もり
- **開発期間**: 1-2週間（1人の開発者）
- **難易度**: 低〜中
- **メリット**: 既存コードの90%以上を再利用可能